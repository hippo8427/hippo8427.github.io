---
title: Weekly Paper 07
date: 2025-07-14
layout: single
---

<br>

## 📌 Express.js 에서 미들웨어란?

### 🔍 개념 정리

**미들웨어(Middleware)란?**  
* **Express.js**에서 요청(Request)과 응답(Response) 사이에 실행되는 **함수**.
* 주로 요청 객체(req), 응답 객체(res), 그리고 다음 미들웨어를 호출하는 next() 함수를 인자로 받음.
* 여러 개의 미들웨어를 **체인처럼 연결**해서 실행 가능.

<br>

#### 📍 중요 포인트
* 미들웨어의 핵심 역할:
  * 요청 데이터 가공 (ex. JSON 파싱, 쿠키 파싱)
  * 공통 기능 처리 (ex. 로깅, 인증, 권한 체크)
  * 오류 처리
  * 라우터로 요청을 전달하거나, 응답을 직접 반환 가능

* 미들웨어는 **등록 순서**가 중요!
  * 순서에 따라 요청 흐름이 달라질 수 있음

<br>

<details> <summary><strong style="font-size: 1.2em;">🔸 미들웨어 종류</strong></summary> 
<div style="background: #f0f0f0; padding: 1em;" markdown="1">

<br>

**1. 애플리케이션 레벨 미들웨어**
  * app.use() 나 app.get() 등에 등록
  * 모든 요청 혹은 특정 경로에 대해 동작

```js
app.use((req, res, next) => {
  console.log('모든 요청에서 실행되는 미들웨어');
  next();
});
```

**2. 라우터 레벨 미들웨어**
  * express.Router() 객체에 등록
  * 특정 라우터에만 적용

```js
const router = express.Router();
router.use((req, res, next) => {
  console.log('특정 라우터에서만 실행');
  next();
});
```

**3. 내장 미들웨어**
  * express.json(), express.static() 등
  * 별도의 설치 없이 제공됨

**4. 오류 처리 미들웨어**
  * 매개변수가 **4개**(err, req, res, next)
  * 에러를 한 곳에서 처리 가능

```js
app.use((err, req, res, next) => {
  console.error(err.stack);
  res.status(500).send('Something broke!');
});
```

</div> 
</details> 

<br>

### 🔍 미들웨어 사용 예시

| 기능 예시            | 미들웨어 활용 내용                       |
| ----------------- | ----------------------------------- |
| **로깅**          | 모든 요청 경로에 대해 console.log 수행 |
| **인증**          | 로그인 여부를 검사하여 라우터 접근 제어 |
| **JSON 파싱**     | body-parser 혹은 express.json() 사용 |
| **정적 파일 제공** | express.static() 활용 |

<br>

#### 📍 중요 포인트

* **next() 호출**을 빼먹으면 요청이 멈추고 응답이 오지 않음.
* 공통 코드 관리에 매우 유용해 **유지보수성이 높음**.

<br>

<details> <summary><strong style="font-size: 1.2em;">🔸 미들웨어 작성 시 팁</strong></summary> 
<div style="background: #f0f0f0; padding: 1em;" markdown="1">

<br>

**팁**

* 항상 **next()** 호출 여부를 체크하자.
* 로직이 길어질 때는 **별도 모듈로 분리**해 관리.
* 오류 처리 미들웨어를 마지막에 등록하자.
* 라우터별로 미들웨어를 분리하면 가독성이 좋아짐.

</div> 
</details> 

<br><br>

## 📌 백엔드 서버에서 이미지 업로드 방식

### 🔍 개념 정리

**이미지 업로드란?**  
* 클라이언트에서 전송한 이미지 파일을 서버에서 수신하고 **저장**하는 과정.
* 저장 방식과 라이브러리 선택에 따라 성능, 확장성, 관리 방식이 달라짐.

<br>

#### 📍 중요 포인트

* 이미지 업로드 방식은 크게 **2가지로 구분**:
  * **서버 로컬 저장**
  * **클라우드 스토리지 저장 (외부 저장소)**

* 업로드 용량 제한, 보안, URL 관리 등을 반드시 고려해야 함.

<br>

<details> <summary><strong style="font-size: 1.2em;">🔸 서버 로컬 저장 방식</strong></summary> 
<div style="background: #f0f0f0; padding: 1em;" markdown="1">

<br>

**특징**
* 서버 디렉토리에 파일을 직접 저장
* 소규모 프로젝트에 적합

**장점**
* 설정이 단순하고 빠르게 구현 가능
* 외부 서비스 비용이 들지 않음

**단점**
* 서버 디스크 용량 한계가 존재
* 서버 이중화(Scale Out) 시 파일 공유가 어려움

**예시 라이브러리**
* multer

```js
const multer = require('multer');
const upload = multer({ dest: 'uploads/' });

app.post('/upload', upload.single('image'), (req, res) => {
  console.log(req.file);
  res.send('파일 업로드 완료');
});
```

</div> 
</details> 

<br>

<details> <summary><strong style="font-size: 1.2em;">🔸 클라우드 스토리지 저장 방식</strong></summary> 
<div style="background: #f0f0f0; padding: 1em;" markdown="1">

<br>

**특징**
* AWS S3, Google Cloud Storage, Azure Blob, Firebase 등 사용
* 이미지 파일을 서버가 아닌 **외부 스토리지**에 저장

**장점**
* 무제한 확장 가능
* 서버 이중화 시 파일 공유가 용이
* CDN 연계로 이미지 로딩 속도 최적화

**단점**
* 서비스 비용 발생
* 초기 설정이 다소 복잡

**예시 라이브러리**
* aws-sdk (Node.js용)
* @google-cloud/storage

```js
const AWS = require('aws-sdk');
const s3 = new AWS.S3();

const params = {
  Bucket: 'your-bucket-name',
  Key: 'image.jpg',
  Body: fileBuffer,
  ContentType: 'image/jpeg'
};

s3.upload(params, (err, data) => {
  if (err) {
    console.error(err);
  } else {
    console.log(data.Location); // 업로드된 이미지 URL
  }
});
```

</div> 
</details> 

<br>

### 🔍 이미지 업로드 비교

| 방식                  | 장점                              | 단점                             |
| ------------------ | ------------------------------- | ----------------------------- |
| **로컬 저장**         | 빠르고 구현 간단                   | 서버 확장 시 파일 공유 어려움      |
| **클라우드 스토리지**   | 무제한 확장, CDN 연계로 빠름          | 비용 발생, 설정이 복잡할 수 있음 |

<br>

#### 📍 중요 포인트

* 상용 서비스에서는 **클라우드 스토리지** 사용을 권장
* 보안을 위해 업로드 경로, 파일명 관리 주의
* 사용하지 않는 파일 정리 정책 필수

<br>

<details> <summary><strong style="font-size: 1.2em;">🔸 이미지 업로드 시 팁</strong></summary> 
<div style="background: #f0f0f0; padding: 1em;" markdown="1">

<br>

**팁**

* 파일명은 **랜덤 문자열 + 확장자**로 저장해 충돌 방지
* MIME 타입 체크로 악성 파일 업로드 방지
* 파일 크기 제한 설정 필수 (multer: limits 옵션)
* 업로드 성공 후 URL 반환 시 HTTPS 사용 권장

</div> 
</details> 
